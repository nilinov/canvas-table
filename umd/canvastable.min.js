!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CanvasTable=e():t.CanvasTable=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",s=t[3];if(!s)return i;if(e&&"function"==typeof btoa){var r=(o=s,l=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(l),"/*# ".concat(h," */")),n=s.sources.map((function(t){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(t," */")}));return[i].concat(n).concat([r]).join("\n")}var o,l,h;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,s){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(s)for(var n=0;n<this.length;n++){var o=this[n][0];null!=o&&(r[o]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);s&&r[h[0]]||(i&&(h[2]?h[2]="".concat(i," and ").concat(h[2]):h[2]=i),e.push(h))}},e}},function(t,e,i){var s=i(3),r=i(4);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1};s(r,n);t.exports=r.locals||{}},function(t,e,i){"use strict";var s,r=function(){return void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s},n=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),o=[];function l(t){for(var e=-1,i=0;i<o.length;i++)if(o[i].identifier===t){e=i;break}return e}function h(t,e){for(var i={},s=[],r=0;r<t.length;r++){var n=t[r],h=e.base?n[0]+e.base:n[0],a=i[h]||0,c="".concat(h," ").concat(a);i[h]=a+1;var d=l(c),p={css:n[1],media:n[2],sourceMap:n[3]};-1!==d?(o[d].references++,o[d].updater(p)):o.push({identifier:c,updater:x(p,e),references:1}),s.push(c)}return s}function a(t){var e=document.createElement("style"),s=t.attributes||{};if(void 0===s.nonce){var r=i.nc;r&&(s.nonce=r)}if(Object.keys(s).forEach((function(t){e.setAttribute(t,s[t])})),"function"==typeof t.insert)t.insert(e);else{var o=n(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(e)}return e}var c,d=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function p(t,e,i,s){var r=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(t.styleSheet)t.styleSheet.cssText=d(e,r);else{var n=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(n,o[e]):t.appendChild(n)}}function u(t,e,i){var s=i.css,r=i.media,n=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),n&&btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}var f=null,g=0;function x(t,e){var i,s,r;if(e.singleton){var n=g++;i=f||(f=a(e)),s=p.bind(null,i,n,!1),r=p.bind(null,i,n,!0)}else i=a(e),s=u.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return s(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;s(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var i=h(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var s=0;s<i.length;s++){var r=l(i[s]);o[r].references--}for(var n=h(t,e),a=0;a<i.length;a++){var c=l(i[a]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}i=n}}}},function(t,e,i){"use strict";i.r(e);var s=i(1),r=i.n(s)()(!1);r.push([t.i,'.x-canvas-table{position:relative;background-color:white}.x-canvas-table,.x-canvas-table *,.x-canvas-table *::before,.x-canvas-table *::after{-webkit-box-sizing:border-box;box-sizing:border-box}.x-canvas-table>canvas{position:absolute}.x-canvas-table .x-canvas-table-mask{position:absolute;top:0;bottom:0;left:0;right:0;z-index:2}.x-canvas-table>.x-canvas-scroll{position:absolute;overflow:hidden}.x-canvas-table>.x-canvas-scroll .x-canvas-scroll-inner{overflow:auto;position:absolute}.x-canvas-table>.x-canvas-scroll .x-canvas-scroll-inner::-webkit-scrollbar{cursor:pointer}.x-canvas-table>.x-canvas-scroll .x-canvas-scroll-inner::-webkit-scrollbar-thumb{border-radius:9px;background-color:rgba(127,127,127,0.85);cursor:pointer}.x-canvas-table>.x-canvas-scroll .x-canvas-scroll-inner .x-canvas-scroll-end{display:inline-block;width:1px;height:1px;position:relative}.x-canvas-table>.x-canvas-scroll .x-scroll-shadow-left{position:absolute;top:0;left:0;transition:box-shadow .3s ease}.x-canvas-table>.x-canvas-scroll .x-scroll-shadow-left.show{box-shadow:6px 0 6px -4px rgba(0,0,0,0.15)}.x-canvas-table>.x-canvas-scroll .x-scroll-shadow-right{position:absolute;top:0;right:0;transition:box-shadow .3s ease}.x-canvas-table>.x-canvas-scroll .x-scroll-shadow-right.show{box-shadow:-6px 0 6px -4px rgba(0,0,0,0.15)}.x-canvas-table .x-canvas-table-selection-cell{position:absolute;display:none;background-color:#e6f7ff;border:none;outline:none}.x-canvas-table .x-canvas-table-selection-cell::-webkit-scrollbar{display:none}.x-canvas-table .x-canvas-table-selection-cell.show{display:inline-block}.x-canvas-table .x-tooltip{position:fixed;background-color:rgba(0,0,0,0.85);color:#fff;font-size:14px;line-height:1.4;outline:0;transition-property:transform,visibility,opacity;padding:8px;border-radius:4px;transform:translate3d(-50%, -120%, 0);display:none}.x-canvas-table .x-tooltip:before{bottom:-4px;left:50%;transform:translateX(-50%);transform-origin:center top;content:"";position:absolute;width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;border-top:4px solid rgba(0,0,0,0.85)}\n',""]),e.default=r},function(t,e,i){"use strict";i.r(e);var s=i(0),r=i.n(s);const n={width:"100%",height:"100%",rowHeight:55,columnWidth:150,borderColor:"#e8e8e8",textColor:"rgba(0,0,0,0.65)",fontSize:"14px",fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft YaHei","Helvetica Neue",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"',headerBackColor:"#fafafa",headerRowHeight:55,padding:16},o=(()=>{const t=document.createElement("canvas").getContext("2d"),e=(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1);return(e<1?1:e)*(localStorage.zoom||1)})();class l{destroy(){Object.getOwnPropertyNames(this).forEach(t=>{this[t]=null})}}const h=t=>{let e=!1;return(null==t||""===t||Array.isArray(t)&&0===t.length||t.constructor===Object&&0===Object.keys(t).length)&&(e=!0),e},a=t=>!h(t),c=t=>Array.isArray(t)&&!h(t),d=t=>"function"==typeof t,p=(t,e="")=>t||0===t?t+"":e,u=(t,e)=>"string"==typeof t?/^\d{1,2}%$/.test(t)?.01*parseInt(t.substring(0,-1))*e():e():"number"==typeof t?t:e(),f={multiValue(t){let e=[];if(Array.isArray(t))switch(t.length){case 1:e=[t[0],t[0],t[0],t[0]];break;case 2:e=[t[0],t[1],t[0],t[1]];break;case 3:e=[t[0],t[1],t[2],t[1]];break;case 4:default:e=[...t]}else e=[t,t,t,t];return e},border(t){if(t){let[e,i]=t.split(/\s{1,}/g);return e=parseInt(e),{width:e,color:i}}return null}},g=(t,e,i="children")=>{let s=1;const r=(t,e)=>{if(t){e(t,s);const n=t[i];s++,Array.isArray(n)&&n.forEach(t=>{r(t,e)}),s--}};Array.isArray(t)?t.forEach(t=>{r(t,e)}):r(t,e)},x=(t,e,i="children")=>{const s=Array.isArray(t)?[...t]:[t];for(;s[0];){const t=s.shift();e(t),Array.isArray(t[i])&&s.push(...t[i])}},b=(t,e="children")=>{const i=[];return g(t,t=>{h(t[e])&&i.push(t)},e),i},v=(t,e,i="parent")=>{let s=t,r=0;for(;s;){if(r++,e(s))return s;if(s=s[i],r>100)return}return null},w=(t,e,i,s,r,n)=>{n&&(t.save(),t.strokeStyle=n),t.beginPath(),t.moveTo(e+.5,i+.5),t.lineTo(s+.5,r+.5),t.closePath(),t.stroke(),n&&t.restore()},y=(t,e,i,s,r,n)=>{n&&(t.save(),t.fillStyle=n),t.fillRect(e,i,s,r),n&&t.restore()};class m extends l{constructor(t){if(super(),this.props=t,r()(this,"_ctx",null),r()(this,"parent",null),r()(this,"children",[]),r()(this,"style",{}),r()(this,"eventHandlers",{}),this._ctx=t.ctx,this.styleInit(),this.children=[...t.children||[]],this.children.forEach(t=>{t.parent=this}),a(t.event))for(const e in t.event)this.on(e,t.event[e]);t.popTitle&&(this.on("onMouseEnter",()=>{this.table.tooltip.show(t.popTitle,this)}),this.on("onMouseLeave",()=>{this.table.tooltip.hide()})),!t.disabled&&t.event&&(this.on("onMouseEnter",()=>{this.ctx.canvas.parentElement.style.cursor="pointer"}),this.on("onMouseLeave",()=>{this.ctx.canvas.parentElement.style.cursor="auto"}))}get ctx(){return((t,e,i=null)=>{const s=v(t,t=>a(t[e]));return s?s[e]:i})(this,"_ctx")}get table(){return v(this,t=>!t.parent).table}styleInit(){let{padding:t,border:e,...i}={...m.defaultStyle,...this.props.style||{}};a(t)?this.style.padding=f.multiValue(t):this.style.padding=[0,0,0,0],a(e)&&(this.style.border=f.multiValue(e).map(t=>f.border(t))),this.style={...this.style,...i}}get isRender(){const t=!(this.left+this.width<0||this.left>this.ctx.canvas.width),e=!(this.top+this.height<0||this.top>this.ctx.canvas.height);return t&&e}get sibings(){return this.parent&&this.parent.children||[]}get left(){const t=this.parent,e=t?t.left+t.padding.left:0;let i=0;for(let e of this.sibings){if(e===this)break;i+=e.width+(t.props.gutter||0)}return e+i+this.style.left}get top(){const t=this.parent;let e=0;if(t)switch(this.style.verticalAlign){case"bottom":e=t.height-this.height;break;case"middle":e=(t.height-this.height)/2}return(t?t.top+t.padding.top:0)+e+this.style.top}get innerWidth(){return this.width-this.padding.right-this.padding.left}get width(){const t=this.parent?this.parent.innerWidth:0;return u(this.style.width,()=>this.parent?t:0)}get innerHeight(){return this.height-this.padding.top-this.padding.bottom}get height(){const t=this.parent?this.parent.innerHeight:0;return u(this.style.height,()=>this.parent?t:0)}get padding(){const[t,e,i,s]=this.style.padding;return{top:t,right:e,bottom:i,left:s}}get border(){const[t,e,i,s]=this.style.padding;return{top:t,right:e,bottom:i,left:s}}get align(){return this.style.align}get zIndex(){return this.style.zIndex}clear(){const{left:t,top:e,height:i,width:s}=this;this.ctx.clearRect(t,e,s,i)}childrenRender(){const t=[...this.children||[]];h(t)||t.sort((t,e)=>t.zIndex-e.zIndex).forEach(t=>{t.innerRender()})}baseRender(){const{backgroundColor:t,border:e}=this.style,{left:i,top:s,width:r,height:n}=this;if(t&&y(this.ctx,i,s+1,r,n-1,t),c(e)){const[t,o,l,h]=e;t&&w(this.ctx,i,s,i+r,s,t.color),o&&w(this.ctx,i+r,s,i+r,s+n,o.color),l&&w(this.ctx,i,s+n,i+r,s+n,l.color),h&&w(this.ctx,i,s,i,s+n,h.color)}}render(){}innerRender(){this.isRender&&(this.baseRender(),this.render(),this.childrenRender())}drawText(t){let e=this.ctx,{left:i,top:s,height:r,width:n}=this,o=0,l=s+r/2;switch(e.save(),this.align){case"center":o=i+n/2,e.textAlign="center";break;case"right":o=i+n-this.padding.right,e.textAlign="right";break;case"left":default:o=i+this.padding.left,e.textAlign="left"}this.style.color&&(e.fillStyle=this.style.color);const h=this.style.fontSize||this.table.style.fontSize,a=this.style.fontFamily||this.table.style.fontFamily,c=this.style.fontWeight||"normal";e.font=[c,h,a].join(" "),e.fillText(t,o,l+this.padding.top),e.restore()}on(t,e){this.eventHandlers[t]||(this.eventHandlers[t]=[]),this.eventHandlers[t].push(e)}off(t,e){const i=this.eventHandlers[t];if(i)if("function"==typeof e){const t=i.indexOf(e);~t&&i.splice(t,1)}else delete this.eventHandlers[t]}trigger(t,e){if(this.props.disabled)return;const i=this.eventHandlers[t];i&&i.forEach(t=>{"function"==typeof t&&t(e)})}}r()(m,"defaultStyle",{top:0,left:0,width:"100%",height:"100%",padding:0,zIndex:0,align:"left",overflow:"ellipsis",verticalAlign:"middle"});class R extends m{constructor(t){super(t),this.props=t,r()(this,"_textEllipsis","")}get text(){return p(this.props.text)}get textEllipsis(){return this._textEllipsis||(this._textEllipsis=((t,e,i,s="…")=>{if("string"!=typeof e)return e;const r=e.length;if(0===r)return e;let n=t.measureText(s).width,o="",l=0,h=0;do{h++,o=e.substring(0,h),l=t.measureText(o).width}while(l<i&&h<r);if(h===r&&(l<=i||l<=n))return o;for(;l+n>=i&&h>0;)o=o.substring(0,h),l=t.measureText(o).width,h--;return o.substring(0,h)+s})(this.ctx,this.text,this.innerWidth)),this._textEllipsis}render(t=this.textEllipsis){this.drawText(t)}}class C extends R{constructor(t){super(t),this.props=t,r()(this,"customRendered",null),this.style.backgroundColor="white",this.on("onClick",()=>{this.customRendered instanceof m||this.showSelection()}),this.on("onMouseEnter",()=>{this.textEllipsis.length!==this.text.length&&this.textEllipsis!==this.text&&this.table.tooltip.show(this.text,this)}),this.on("onMouseLeave",()=>{this.table.tooltip.hide()})}showSelection(){const t=this.table.selectionCell;t.classList.remove("show"),setTimeout(()=>{t.value=this.text,t.style.top=this.top+this.table.scroller.top+1+"px",t.style.left=this.left+this.table.scroller.left+"px",t.style.width=this.width+"px",t.classList.add("show"),t.select()},10)}update(){this._textEllipsis="",this.customRendered=null,this.children=[]}get top(){return this.row.top}get left(){return this.column.left}get width(){return this.column.width}get column(){return this.props.column}get height(){return this.row.height}get align(){return this.column.align}get row(){return this.props.row}get table(){return this.column.table}get isRender(){return this.column.isRender&&this.row.isRender}get fixed(){return this.column.fixed}get text(){return p("string"==typeof this.customRendered?this.customRendered:this.data)}get name(){return this.column.name}get data(){return this.row.data&&this.row.data[this.name]}get zIndex(){return"left"===this.fixed||"right"===this.fixed?1:0}trigger(t,e){if(super.trigger(t,e),d(this.column.onCell)){let i=this.column.onCell(this.row.data,this.column.index);if(i){const s=i[t];d(s)&&s(e)}}}render(){d(this.column.customRender)?(h(this.children)&&(this.customRendered=this.column.customRender(this.data,this.row.data),this.customRendered instanceof m&&(this.customRendered.parent=this,this.children=[this.customRendered])),"string"==typeof this.customRendered&&super.render()):super.render()}}class S extends m{constructor(t){super({...t,style:{backgroundColor:"white",border:[null,null,"1px",null]}}),this.props=t,r()(this,"index",this.props.index),this.on("onMouseEnter",()=>{this.highlight(!0)}),this.on("onMouseLeave",()=>{this.highlight(!1)})}get data(){return this.table.source[this.index]}get cells(){return this.children}cellsCreate(){this.children=this.table.header.columns.map(t=>new C({ctx:this.table.ctx,row:this,column:t,style:{padding:[0,this.table.style.padding],zIndex:t.fixed?1:0}}))}get left(){return 0}get width(){return this.table.style.width}get top(){let t=this.table;return t.header.height+this.index*t.style.rowHeight-t.scroller.top-1}get isRender(){return!(this.top+this.height<this.table.header.height||this.top>this.table.style.height)}get height(){return this.table.style.rowHeight}get table(){return this.props.table}update(){a(this.cells)&&this.cells.forEach(t=>t.update())}trigger(t,e){if(super.trigger(t,e),d(this.table.props.onRow)){let i=this.table.props.onRow(this.data,this.index);if(i){const s=i[t];d(s)&&s(e)}}}highlight(t){this.cells.forEach(e=>e.style.backgroundColor=t?"#e6f7ff":"#ffffff"),this.style.backgroundColor=t?"#e6f7ff":"#ffffff",this.table.render()}get ctx(){return this.table.ctx}render(){h(this.cells)&&this.cellsCreate()}}class k extends l{constructor(t){super(),this.props=t,r()(this,"top",void 0),r()(this,"table",void 0),r()(this,"rows",[]),this.init()}init(){this.table=this.props.table,this.top=this.table.header.height}get width(){return this.table.style.width}get height(){return(this.rows||[]).reduce((t,e)=>t+e.height,0)}diff(t){return h(t)?[]:t.map((t,e)=>new S({ctx:this.table.ctx,table:this.table,index:e}))}render(t=0,e=this.table.source.length){if(h(this.rows)&&(this.rows=Array.from({length:e}).map((e,i)=>new S({table:this.table,index:t+i}))),h(this.rows)){const t=this.table.header.height,e=this.table.style.height-t,i=this.table.style.width;((t,e,i,s,r,n=140)=>{let o=n+.4*n,l=e+s/2,h=i+r/2-(o-n);t.save(),t.fillStyle="#ebebeb",t.beginPath(),t.arc(l,h,n/2,0,2*Math.PI,!1),t.fill(),t.strokeStyle="#ffffff",t.lineWidth=n/20,t.beginPath();let a=n/3,c=Math.PI/6,d=Math.cos(c)*a,p=Math.sin(c)*a;t.save(),t.beginPath(),t.lineTo(l,h-2*p),t.lineTo(l+d,h-p),t.lineTo(l+d,h-p+a),t.lineTo(l,h+a),t.lineTo(l-d,h-p+a),t.lineTo(l-d,h-p),t.closePath(),t.stroke(),t.beginPath(),t.lineTo(l,h),t.lineTo(l-d,h-p),t.stroke(),t.beginPath(),t.lineTo(l,h),t.lineTo(l+d,h-p),t.stroke(),t.beginPath(),t.lineTo(l,h),t.lineTo(l,h+a),t.stroke(),t.beginPath(),t.lineTo(l+d/2,h-p/2),t.lineTo(l-d/2,h-3*p/2),t.stroke(),t.restore();let u=.2*n;t.fillStyle="#cecece",t.textAlign="center",t.textBaseline="middle",t.font=u+'px -apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft YaHei","Helvetica Neue",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"',t.fillText("暂无数据",l,h+n/2+(o-n)/2),t.restore()})(this.table.ctx,0,t,i,e)}else this.rows.forEach(t=>t.innerRender())}clear(){this.rows.forEach(t=>t.destroy()),this.rows=[]}}var E=function(t,e={},...i){function s(t){if(!Array.isArray(t))return null;const e=[];return t.forEach(t=>{Array.isArray(t)?e.push(...t):e.push(t)}),e}let r=null;return r="string"==typeof t?function(t,e,...i){let r=document.createElement(t);if(e&&"object"==typeof e)for(let t in e){let i=e[t];if("style"===t&&i&&"object"==typeof i)for(let t in i)r.style[t]=i[t];else 0===t.indexOf("data-")?(t=t.slice(5).split("-").map((t,e)=>(0!==e&&(t=t[0].toUpperCase()+t.slice(1)),t)).join(""),r.dataset[t]=i):r[t]=i}let n=s(i).filter(t=>a(t)).map(t=>{let e=null;return["string","boolean","number"].includes(typeof t)?e=document.createTextNode(t+""):t instanceof Node?e=t:t.wrapper instanceof Node&&(e=t.wrapper),e});return Array.isArray(n)&&n.forEach(t=>{r.appendChild&&r.appendChild(t)}),r}(t,e,...i):function(t,e,...i){return new t({...e,children:s(i)})}(t,e,...i),e&&e.ref&&("current"in e.ref?e.ref.current=r:"function"==typeof e.ref&&e.ref(r)),r};class L{constructor(t){this.props=t,r()(this,"fixedLeftWidth",0),r()(this,"fixedRightWidth",0),r()(this,"scrollWidth",0),r()(this,"scrollHeight",0),r()(this,"direction",void 0),r()(this,"top",0),r()(this,"left",0),r()(this,"scrollHandler",()=>{const t=this.scrollRef.current.scrollTop,e=this.scrollRef.current.scrollLeft,i=t-this.top,s=e-this.left;s>0?this.direction="right":s<0?this.direction="left":i>0?this.direction="down":i<0&&(this.direction="up"),this.top=t,this.left=e,this.shadowRender(),"function"==typeof this.props.onScroll&&this.props.onScroll(this.left,this.top,this.direction)}),r()(this,"wrapper",null),r()(this,"scrollRef",{current:null}),r()(this,"scrollEndRef",{current:null}),r()(this,"shadowLeftRef",{current:null}),r()(this,"shadowRightRef",{current:null}),this.wrapper=this.domInit(),L.hasStyle||(document.head.appendChild(E("style",null,".x-canvas-table .x-canvas-scroll .x-canvas-scroll-inner::-webkit-scrollbar {width: 10px;height: 10px;}")),L.hasStyle=!0)}scrollTo(t,e){this.scrollRef.current.scrollTo({left:t,top:e,behavior:"auto"})}update(t,e,i,s){this.scrollWidth=t,this.scrollHeight=e,this.scrollEndRef.current.style.top=e-10-4+"px",this.scrollEndRef.current.style.left=t-1+"px",this.fixedLeftWidth=this.props.fixedLeftWidth(),this.fixedRightWidth=this.props.fixedRightWidth(),this.shadowLeftRef.current.style.width=this.fixedLeftWidth+"px",this.shadowRightRef.current.style.width=this.fixedRightWidth+"px";let r=Math.min(s,this.props.height-10);this.shadowLeftRef.current.style.height=r+"px",this.shadowRightRef.current.style.height=r+"px",this.shadowRender()}shadowDraw(t){const e=this.shadowLeftRef.current,i=this.shadowRightRef.current;switch(t){case"both":e.classList.add("show"),i.classList.add("show");break;case"left":e.classList.add("show"),i.classList.remove("show");break;case"right":e.classList.remove("show"),i.classList.add("show");break;case"none":default:e.classList.remove("show"),i.classList.remove("show")}}shadowRender(){let{scrollWidth:t,scrollLeft:e,clientWidth:i}=this.scrollRef.current;0===e?this.shadowDraw("right"):t-e===i?this.shadowDraw("left"):this.shadowDraw("both")}domInit(){return E("div",{className:"x-canvas-scroll",style:{width:this.props.width+"px",height:this.props.height+"px"}},E("div",{ref:this.shadowLeftRef,className:"x-scroll-shadow-left"}),E("div",{ref:this.shadowRightRef,className:"x-scroll-shadow-right",style:{right:"10px"}}),E("div",{className:"x-canvas-scroll-inner",ref:this.scrollRef,onscroll:this.scrollHandler,style:{width:this.props.width+"px",height:this.props.height+"px"}},E("div",{ref:this.scrollEndRef,className:"x-canvas-scroll-end"}),this.props.children))}}r()(L,"hasStyle",!1);var T=class extends R{constructor(t){super(t),this.props=t,r()(this,"parentCell",null),r()(this,"childrenCell",[]),r()(this,"_width",null),r()(this,"_height",null),r()(this,"_left",null),r()(this,"_top",null),r()(this,"customRendered",null),this.style.backgroundColor=this.table.style.headerBackColor,this.style.fontWeight="bold",this.parentCell=t.parent,this.parentCell&&this.parentCell.childrenCell.push(this)}get table(){return this.props.table}get header(){return this.table.header}get fixed(){return this.props.colProps.fixed}get width(){return null===this._width&&(this._width=b(this,"childrenCell").reduce((t,e)=>t+(e.props.colProps.width||this.table.style.columnWidth),0)),this._width}get height(){if(null===this._height)if(h(this.childrenCell)){let t=this.table.header.deep-(this.treeHeight-1+((t,e="children")=>{let i=0;return g(t,(t,e)=>{e>i&&(i=e)},e),i})(this.props.colProps)-1);this._height=t*this.table.style.headerRowHeight}else this._height=this.table.style.headerRowHeight;return this._height}get left(){if(null===this._left){let t=0;const e=this.siblings;if(h(this.parentCell))switch(this.fixed){case"left":for(let i=0,s=null;i<e.length&&(s=e[i],"left"===s.fixed)&&s!==this;i++)t+=s.width;break;case"right":for(let i=e.length-1,s=null;i>=0&&(s=e[i],"right"===s.fixed)&&(t+=s.width,s!==this);i--);t=this.table.style.width-t;break;default:for(let i=0,s=null;i<e.length&&(s=e[i],s!==this);i++)t+=s.width}else{for(let i=0,s=null;i<e.length&&(s=e[i],s!==this);i++)t+=s.width;t+=this.parentCell.left}this._left=t}return"left"!==this.fixed&&"right"!==this.fixed?this._left-this.table.scroller.left:this._left}get top(){return null===this._top&&(this._top=(this.treeHeight-1)*this.table.style.headerRowHeight-1),this._top}get align(){return this.props.colProps.align||(h(this.props.colProps.children)?"left":"center")}get text(){return this.props.colProps.title+""}get treeHeight(){let t=0,e=this;for(;e;){if(t++,t>1e4)return 1e4;e=e.parentCell}return t}get siblings(){return this.parentCell?[...this.parentCell.childrenCell]:[...this.header.rootCells]}borderRect(){const{left:t,top:e,width:i,height:s}=this,r=e+s;w(this.ctx,t,r,t+i,r),this.header.deep>1&&w(this.ctx,t+i-1,e-1,t+i-1,e+s-1)}get zIndex(){return"left"===this.fixed||"right"===this.fixed?1:0}render(){this.isRender&&(this.borderRect(),"function"==typeof this.props.colProps.title?(null===this.customRendered&&(this.customRendered=this.props.colProps.title(),this.customRendered instanceof m&&(this.customRendered.parent=this,this.children=[this.customRendered])),"string"==typeof this.customRendered&&super.render(this.customRendered)):super.render())}};class _{constructor(t){this.props=t}get align(){return this.props.align||"left"}get width(){return this.props.width||this.table.style.columnWidth}get left(){return this.table.header.leafCells[this.index].left}get index(){return this.props.index}get fixedIndex(){return this.props.fixedIndex}get name(){return this.props.dataIndex||this.props.key}get title(){return this.props.title}get key(){return this.props.key||this.props.dataIndex}get table(){return this.props.table}get fixed(){return this.props.fixed}get isRender(){return!(this.left+this.width<0||this.left>this.table.style.width)}get customRender(){return this.props.render}get onCell(){return this.props.onCell}}class H extends l{constructor(t){super(),this.props=t,r()(this,"columns",[]),r()(this,"leftColumns",[]),r()(this,"rightColumns",[]),r()(this,"notFixedColumns",[]),r()(this,"deep",1),r()(this,"rootCells",[]),r()(this,"leafCells",[]),r()(this,"top",0);const e=function(t){const e=t.filter(t=>"left"===t.fixed).map((t,e)=>({...t,fixedIndex:e})),i=t.filter(t=>"right"===t.fixed).map((t,e)=>({...t,fixedIndex:e})),s=t.filter(t=>!["left","right"].includes(t.fixed));return{fixedLeft:e,notFixed:s,fixedRight:i}}(t.colProps);this.columnsInit(e),this.cellNodesInit(e)}columnsInit({fixedLeft:t,notFixed:e,fixedRight:i}){let s=0;const r=[t,e,i],n=[this.leftColumns,this.notFixedColumns,this.rightColumns];[...t,...i,...e].forEach(t=>{g(t,e=>{e.fixed=t.fixed})}),r.forEach((t,e)=>{b(t).forEach(t=>{n[e].push(new _({...t,table:this.props.table,index:s++}))})}),this.columns=[...this.leftColumns,...this.notFixedColumns,...this.rightColumns]}cellNodesInit({fixedLeft:t,notFixed:e,fixedRight:i}){const s=[...t,...e,...i];let r=null;const n=this.table;for(;s[0];){const t=s.shift();r=new T({colProps:t,popTitle:t.popTitle,parent:t.__PARENT__,table:n,ctx:n.ctx,style:{padding:[0,n.style.padding]}}),h(t.__PARENT__)&&this.rootCells.push(r),delete t.__PARENT__,Array.isArray(t.children)&&s.push(...t.children.map(t=>({__PARENT__:r,...t})))}r&&(this.deep=r.treeHeight),this.leafCells=b(this.rootCells,"childrenCell")}get cells(){let t=[];return x(this.rootCells,e=>t.push(e),"childrenCell"),t}get width(){return this.table.width}get height(){return this.deep*this.table.style.headerRowHeight}get table(){return this.props.table}render(){if(h(this.rootCells))return;const t=this.table.ctx;y(t,0,0,this.table.style.width,this.height,this.table.style.headerBackColor),w(t,0,this.height-1,this.table.style.width,this.height-1);const e=this.rootCells.filter(t=>"left"===t.fixed),i=this.rootCells.filter(t=>"right"===t.fixed),s=this.rootCells.filter(t=>"left"!==t.fixed&&"right"!==t.fixed);t.save(),t.beginPath();let r=e.reduce((t,e)=>t+e.width,0),n=s.reduce((t,e)=>t+e.width,0);t.rect(r,0,n,this.height),t.clip(),x(s,t=>t.innerRender(),"childrenCell"),t.restore(),x(e,t=>t.innerRender(),"childrenCell"),x(i,t=>t.innerRender(),"childrenCell")}}class P{constructor(t={}){r()(this,"clientX",void 0),r()(this,"clientY",void 0),r()(this,"path",void 0),r()(this,"target",null),r()(this,"type",void 0),r()(this,"_isPropagationStopped",!1),this.clientX=t.clientX,this.clientY=t.clientY,this.path=t.path||[],this.target=this.path[0]||null,this.type=t.type}get isPropagationStopped(){return this._isPropagationStopped}stopPropagation(){this._isPropagationStopped=!0}copy(t={}){const{clientX:e,clientY:i,path:s,type:r}=this;return new P({clientX:e,clientY:i,path:[...s||[]],type:r,...t})}}class M{constructor(t){this.props=t,r()(this,"eventX",0),r()(this,"eventY",0),r()(this,"eventHandler",(t,e)=>{const{left:i,top:s}=this.table.wrapper.getBoundingClientRect();this.eventX=e.clientX-i,this.eventY=e.clientY-s;const r=this.eventGenerate(t);for(let e of r.path)r.isPropagationStopped||e.trigger(t,r)}),r()(this,"lastMoveEvent",null),r()(this,"moveEventHandler",t=>{const{left:e,top:i}=this.table.wrapper.getBoundingClientRect();this.eventX=t.clientX-e,this.eventY=t.clientY-i;const s=this.eventGenerate("onMouseEnter"),r=this.lastMoveEvent?this.lastMoveEvent.copy({type:"onMouseLeave"}):null,n=s&&s.path?[...s.path].reverse():[],o=r&&r.path?[...r.path].reverse():[],l=Math.max(n.length,o.length);for(let t=0;t<l;t++){const e=o[t],i=n[t];e!==i&&(r&&!r.isPropagationStopped&&e&&e.trigger(r.type,r),s.isPropagationStopped||i&&i.trigger(s.type,s))}this.lastMoveEvent=s}),r()(this,"onMouseLeave",t=>{const e=this.lastMoveEvent?this.lastMoveEvent.copy({type:"onMouseLeave"}):null;if(!h(e)){for(let t of e.path)e.isPropagationStopped||t.trigger(e.type,e);this.lastMoveEvent=null}}),this.init()}init(){const t=this.table.wrapper;t.addEventListener("click",t=>this.eventHandler("onClick",t)),t.addEventListener("dblclick",t=>this.eventHandler("onDoubleClick",t)),t.addEventListener("contextmenu",t=>this.eventHandler("onContextMenu",t)),t.addEventListener("mousemove",t=>this.moveEventHandler(t)),t.addEventListener("mouseleave",t=>this.onMouseLeave(t))}eventGenerate(t){return new P({type:t,path:this.pathGet(),clientX:this.eventX,clientY:this.eventY})}pathGet(){let t=null;if(this.eventY<=this.table.header.height){let e=[...this.table.header.cells];e.sort((t,e)=>e.zIndex-t.zIndex);for(let i of e){const{left:e,top:s,width:r,height:n}=i;if(i.isRender&&e<this.eventX&&e+r>this.eventX&&s<this.eventY&&s+n>this.eventY){t=i;break}}}else for(let e of this.table.body.rows)if(this.eventY>e.top&&this.eventY<e.top+e.height){t=e;break}const e=(t,i=[])=>{if(i.push(t),c(t.children)){const s=[...t.children].sort((t,e)=>e.zIndex-t.zIndex);for(let t of s){const{left:s,top:r,width:n,height:o}=t;if(t.isRender&&s<this.eventX&&s+n>this.eventX&&r<this.eventY&&r+o>this.eventY)return e(t,i)}return i}return i};return t?e(t).reverse():[]}get table(){return this.props.table}}class I extends m{constructor(t){super(t),this.props=t,this.props={...I.defaultProps,...this.props||{}},this.style.padding=[0,8,0,8]}roundRect(){const t=this.width,e=this.height,i=this.left,s=this.top;let r=5;t<2*r&&(r=t/2),e<2*r&&(r=e/2),this.ctx.beginPath(),this.ctx.moveTo(i+r,s),this.ctx.arcTo(i+t,s,i+t,s+e,r),this.ctx.arcTo(i+t,s+e,i,s+e,r),this.ctx.arcTo(i,s+e,i,s,r),this.ctx.arcTo(i,s,i+t,s,r),this.ctx.closePath()}iconRender(){const{iconSize:t,icon:e}=this.props;this.ctx.save(),this.ctx.font=(t||"1em")+" iconfont";const i="0"+e.slice(2,-1);this.drawText(String.fromCharCode(parseInt(i))),this.ctx.restore()}render(){const{type:t,icon:e}=this.props;"default"===t&&(this.roundRect(),this.ctx.stroke()),e&&this.iconRender()}}r()(I,"defaultProps",{type:"default"});const A={},W={},z={};function j(t,e){return t+"__"+e}var N=class extends m{constructor(t){super(t),this.props=t,this.init()}init(){const{path:t,style:{color:e}}=this.props;(async function(t,e){const i=j(t,e);if(A[i])return null;if(z[t])return null;const s=await async function(t){if(W[t])return null;z[t]=!0;const[e,i]=await fetch(t).then(t=>[t,null],t=>[null,t]);if(i)return console.warn(i),null;return W[t]=await e.text(),delete z[t],W[t]}(t);s&&(A[i]=function(t,e){t=t.replace("<svg ",`<svg fill="${e}" `);const i=new Blob([t],{type:"image/svg+xml"}),s=URL.createObjectURL(i),r=document.createElement("img");return r.addEventListener("load",()=>{URL.revokeObjectURL(s)},{once:!0}),r.src=s,r}(s,e));return A[i]})(t,e||"").then(t=>{t&&t.addEventListener("load",()=>{this.table.render()},{once:!0})})}render(){const{path:t,style:{color:e}}=this.props,i=j(t,e),s=A[i];s&&s.complete&&this.ctx.drawImage(s,this.left,this.top,this.width,this.height)}};var B=class{constructor(){r()(this,"wrapper",null),this.domInit()}show(t,e){this.wrapper.style.display="inline-block",this.wrapper.textContent=t;const i=e.table.wrapper.getBoundingClientRect(),s=e.top+i.top,r=e.left+i.left+e.width/2;this.wrapper.style.top=s+"px",this.wrapper.style.left=r+"px"}hide(){this.wrapper.style.display="none"}domInit(){return E("div",{ref:t=>{this.wrapper=t},className:"x-tooltip"})}};class F{constructor(t){this.props=t,r()(this,"style",null),r()(this,"outerHeight",0),r()(this,"outerWidth",0),r()(this,"ctx",null),r()(this,"event",null),r()(this,"tooltip",null),r()(this,"onWindowResizeHandler",function(t,e){let i=null;return function(...s){let r=this;clearTimeout(i),i=setTimeout((function(){t.apply(r,s)}),e)}}(()=>{this.resize()},300)),r()(this,"header",void 0),r()(this,"body",void 0),r()(this,"_source",[]),r()(this,"height",0),r()(this,"width",0),r()(this,"dataHeight",0),r()(this,"dataWidth",0),r()(this,"isFirstRender",!0),r()(this,"isScrollLoading",!1),r()(this,"scrollMask",E("div",{className:"x-canvas-table-mask"})),r()(this,"scrollPosition",{scrollLeft:0,scrollTop:0}),r()(this,"onScrollHandler",(t,e,i)=>{this.render(),"up"===i&&0===e&&d(this.props.onScrollTop)&&this.props.onScrollTop();const{scrollHeight:s,scrollTop:r,scrollLeft:n,clientHeight:o}=this.scroller.scrollRef.current,l=this.props.scrollLoadHeight||150;if("down"===i&&s-r-l<=o&&!this.isScrollLoading&&d(this.props.onScrollLoad)){const t=()=>{const t=this.wrapper;t.isSameNode(this.scrollMask.parentElement)&&t.removeChild(this.scrollMask),this.isScrollLoading=!1};(()=>{this.wrapper.appendChild(this.scrollMask),this.isScrollLoading=!0})();const e=this.props.onScrollLoad();e&&e.then?e.then(()=>{t()}).catch(()=>{t()}):t()}this.scrollPosition={scrollLeft:n,scrollTop:r},this.selectionCell&&this.selectionCell.classList.remove("show"),this.tooltip&&this.tooltip.hide()}),r()(this,"canvas",void 0),r()(this,"scroller",void 0),r()(this,"selectionCell",void 0),r()(this,"_wrapper",null),this.init()}init(t=!0){const{container:e,style:i}=this.props;this.styleCalc(),this.domInit(),t&&(this.event=new M({table:this}),e&&e.appendChild(this.wrapper)),this.ctxInit(),this.componentsInit(),t&&("string"!=typeof i.height&&"string"!=typeof i.width||window.addEventListener("resize",this.onWindowResizeHandler))}styleCalc(){this.props.style={...n,...this.props.style||{}};const{height:t,width:e,...i}=this.props.style;this.style=i,this.outerWidth=u(e,()=>this.props.container.clientWidth),this.outerHeight=u(t,()=>this.props.container.clientHeight),this.style.width=this.outerWidth-10-0,this.style.height=this.outerHeight-10-0}ctxInit(){this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.ctx.setTransform(o,0,0,o,0,0),this.ctx.fillStyle=this.style.textColor,this.ctx.font=this.style.fontSize+" "+this.style.fontFamily,this.ctx.textBaseline="middle",this.ctx.strokeStyle=this.style.borderColor}componentsInit(){this.header=new H({colProps:this.props.columns,table:this}),this.body=new k({table:this})}set source(t){const e=c(t)?[...t]:[];this.body.rows=this.body.diff(e),this._source=[...e],this.sizeCalc(),this.scroller.update(this.width,this.height,this.dataWidth,this.dataHeight),this.render()}get source(){return this._source}sizeCalc(){this.dataHeight=this.header.height+this.source.length*this.style.rowHeight,this.dataWidth=this.header.columns.reduce((t,e)=>t+e.width,0),this.height=Math.max(this.style.height,this.dataHeight),this.width=Math.max(this.style.width,this.dataWidth)}render(){this.ctx.clearRect(0,0,this.style.width,this.style.height),this.body.render(),this.header.render(),this.isFirstRender&&(this.isFirstRender=!1,setTimeout(()=>{this.render()},30))}resize(){this.init(!1),this.sizeCalc(),this.scroller&&this.scroller.update(this.width,this.height,this.dataWidth,this.dataHeight),this.render(),this.scroller&&this.scroller.scrollTo(this.scrollPosition.scrollLeft,this.scrollPosition.scrollTop)}get wrapper(){return null===this._wrapper&&(this._wrapper=E("div",{className:"x-canvas-table",style:{padding:"0px"}})),this._wrapper}domInit(){this.wrapper.innerHTML="";const{height:t,width:e,rowHeight:i,padding:s,fontFamily:r,fontSize:n,textColor:l}=this.style,{outerHeight:h,outerWidth:a}=this;this.wrapper.style.width=a+"px",this.wrapper.style.height=h+"px",this.wrapper.appendChild(E("canvas",{width:e*o,height:t*o,style:{height:t+"px",width:e+"px"},ref:t=>{this.canvas=t}}));const c=E(L,{ref:t=>{this.scroller=t},fixedLeftWidth:()=>this.header.leftColumns.reduce((t,e)=>t+e.width,0),fixedRightWidth:()=>this.header.rightColumns.reduce((t,e)=>t+e.width,0),height:h,width:a,onScroll:this.onScrollHandler},E("input",{readOnly:!0,ref:t=>{this.selectionCell=t},className:"x-canvas-table-selection-cell",style:{height:i-1+"px",lineHeight:i-1+"px",padding:`0 ${s}px`,fontSize:n,fontFamily:r,color:l},onclick:t=>{t.preventDefault(),t.stopPropagation()},onblur:()=>this.selectionCell.classList.remove("show")}));this.wrapper.appendChild(c.wrapper),this.tooltip=E(B,null),this.wrapper.appendChild(this.tooltip.wrapper)}destroy(){window.removeEventListener("resize",this.onWindowResizeHandler)}}r()(F,"Button",I),r()(F,"Layer",m),r()(F,"Text",R),r()(F,"Svg",N);var O=F;i(2),e.default=O}]).default}));